# 1 背景
之前买了一年的89的阿里云，配置是1Core 2g ram，不不装什么的中间件的话，应该是够用了。但是！redis、kafka、zookeeper什么的都还没折腾过，怎么可能放弃折腾呢……于是，想以自己的笔记本硬件作为运行环境，探索一套可行的替代方案。最终，终于实现了：
* 有公网IP的前提下
* 在windows中安装vmware workstation（非免费版）
* 通过设置NAT和防火墙
* 实现了，ssh外网访问vmware中的Ubuntu server，浏览器访问Ubuntu server中运行的服务
# 2 步骤及原理
网络应用，说的直白就是，以[IP+端口]为单位的信息载体，之间的信息交换，主要实现了[IP+端口]的贯通，即可实现信息交换，使用网络服务了。

接下来，以实现从公网，用默认的22端口，ssh到笔记本的vmware中的Ubuntu为例，讲解整个过程。

## 2.1 公网IP
百度查询“IP”，查到的IP和光猫/入户路由器中显示的一至，即可认为自己已经获得公网IP。**假设我的公网IP就是 139.139.139.139，下文将使用此公网IP。**

但是！一般情况下，公网IP也是动态分配的，过一段时间也会变，如果对外提供稳定的服务，可以：
* 买个便宜的阿里云域名
* 写个小的后台程序，nodejs、python、java都可以，不停的查自己的公网IP，然后使用阿里云提供的域名api，将查到的公网IP绑定到自己买的域名
这样，就能通过自己买的域名长期使用自己变化的公网IP提供的服务了。

## 2.2 设置路由器/光猫的转发
外网访问139.139.139.139时，实际上是直接访问获得该IP的光猫/路由器的（以下简称光猫，毕竟现在都是光纤入户了），并且，光猫基本都有安全措施，比如禁止ping，一开始不对光猫做任何设置，一般是无法简单通过IP访问直接访问到光猫后面的网络设备的，并且光猫也不会对你的访问做出任何回应。

因此，要将外部的请求向内部的网络设备转发，让内部的设备完成响应。因此，对光猫进行NAT设置，一般三种NAT方式：
* 端口转发，将外网对自己公网的A端口的访问，转发到内网（光猫的下一级局域网）B.B.B.B的C端口。可以批量设置。
* 端口映射，端口转发的“批量转发”版，将一段范围的端口，按照顺序转发到某IP的某一段端口。如果，“一段范围”的大小就是1，比如666-666端口，那就和端口转发没啥区别了。
* DMZ，将外部的全范围段的端口的请求，全部转发到局域网的某一个IP的设备中。我就是采用的这种方式，虽然有一定的网络安全风险，及时打系统补丁，问题应该不大。
我的目的是，实现ssh到内网设备，端口转发和端口映射，需要将22端口的请求，转发到内网IP的22端口。DMZ方式，无需额外设置。

## 2.3 设置Windows防火墙
win+s，搜索，防火墙，打开之后，“入站规则”——“新建规则”——选择以端口/程序作为转发粒度——转发特定的22端口——取好名字和规则描述，方便自己辨认。

对防火墙经过设置，Windows就不会拦截光猫通过22端口转发给自己的请求了。其他端口的类似。**阿里云的也有类似的防火墙规则，需要自己更改规则**

## 2.4 设置VMware转发到Ubuntu server
使用VMware workstation启动ubuntu虚拟机，不要用player版，player版不支持设置NAT转发。ifconfig查询Ubuntu的IP地址，假设为192.168.128.128。现在，需要设置vmware的网络设置，将发给Windows的22端口请求，转发给192.168.128.128这个虚拟机IP的22端口。

左上角编辑——虚拟网络设置——更改设置——页面会重启一下，选择NAT的外部连接模式——NAT设置——添加，添加一条转发规则，即上面提到的，发给Windows的22端口请求，转发给192.168.128.128这个虚拟机IP的22端口。应用！确认！

完事！！
使用mobaxterm，ssh到username@公网IP，即可。同理，自己部署在Ubuntu中的应用，也可以通过NAT的方式，一层一层的进行转发，最终实现，外网对Ubuntu虚拟机资源/应用的访问。经过试验，自己笔记本的1core和2g ram，和阿里云的性能相差不大，自己还可以多部署一些中间件、大型数据库玩一玩。

